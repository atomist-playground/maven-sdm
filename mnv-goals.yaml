node_build:  
  test: 
  - has_file: pom.xml
      
  goals:   
  - containers:  
    - name: mvn-test   
      image: maven:3-jdk-8-slim
      args:
      - mvn
      - package
      volumeMounts:
      - name: repo
        mountPath: /root/.m2
    volumes:
    - name: repo
      hostPath:
        path: ${home}/.m2
    output:
    - classifier: target
      pattern:
        directory: target
        
docker_build:    
  test: 
  - has_file: Dockerfile  
    
  depends_on: node_build 
         
  goals:   
  - containers:   
    - name: kaniko
      image: gcr.io/kaniko-project/executor
      args: 
      - --context=dir:///atm/home
      - --destination=${push.repo.owner}/${push.repo.name}:${push.after.sha}
      - --dockerfile=Dockerfile
      - --no-push
      - --single-snapshot
    input: 
    - target
