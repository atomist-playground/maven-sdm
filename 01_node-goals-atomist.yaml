configuration:
  logging:
    level: info
  sdm:
    cache:
      enabled: true
      path: /tmp/cache
    goal:
      timeout: 1200000

immaterial:
  test:
  - not:
      is_material_change:
        files:
          - package.json
          - Dockerfile
        extensions:
          - ts

  goals: lock

node_build:
  test:
  - has_file: package.json

  goals:
  - atomist/version-goal@master
  - atomist/npm-goal/npm-test@master
  - atomist/npm-goal/npm-publish@master:
      parameters:
        access: public
  - tag

docker_build:
  test:
  - has_file: package.json
  - has_file: Dockerfile

  depends_on:
  - node_build

  goals:
  - atomist/docker-goal/docker-build-push@master:
      parameters:
        dockerfile: Dockerfile
        registry: atomist
      input:
      - version
      - npm-test
